---
output: pdf_document
---



```{r echo=FALSE, message=FALSE, cache=FALSE, warning=FALSE, out.width="95%", fig.cap= "\\textbf{Figure 3}.", fig.width=8, fig.height=8}

library(ggplot2)
library(ggtree)
library(ggnewscale)
library(ggtreeExtra)
library(cowplot)


#Save data to plot it in markdown file
c = readRDS("../Data/Working_files/Figures/data_figure3b.rds")
tree_family_interactions = readRDS("../Data/Working_files/Figures/data_figure3a1.rds")
plant_fam_interactions = readRDS("../Data/Working_files/Figures/data_figure3a2.rds")

# The circular layout tree
p = ggtree(tree_family_interactions, 
    layout="fan", size=0.1, open.angle=5, alpha=0.5)+ 
geom_tippoint(aes(size= Family_species), colour='cyan4') +
geom_tiplab(linetype='dashed', linesize=.05, 
    size=1.75, color= "black", offset = -45, fontface="bold") +
labs("log(Species)")+
scale_size(name = "log(Species #)") +
ggtitle("a)") +
theme(plot.title = element_text(vjust = -31, hjust = 0.12),
      legend.position = "bottom")

#Create barplot around circular tree
p1 = p + 
new_scale_fill() +
geom_fruit(data=plant_fam_interactions, geom=geom_bar,
   mapping=aes(y=Plant_family1, x=Family_interactions1),
   pwidth=0.38, 
   orientation="y", 
   stat="identity", 
   color = "black") +
theme(legend.margin=margin(0,0,0,0),
   legend.box.margin=margin(-50,-50,-50,-50),
   plot.margin = margin(-15, -15, -10, -10, "pt")) +
scale_size(name = "log(species number)", range=c(0,4))

p2 = ggplot() + 
geom_col(data = c, 
  aes(x = reorder(Family_names, Spp_per_family), 
  y = log(Spp_per_family), fill = Group), position=position_dodge(0.1),width=1) +
xlab(NULL) +
ylab("log(species number)") +
theme_bw() +
theme(axis.text.y = element_text(size = 5, face = "bold", color = "black"),
      panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
coord_flip(expand = F) +
scale_fill_manual(name="", values = c("black", "cyan4")) +
  theme(plot.margin = margin(-10, 0, -10, -10, "pt")) +
ggtitle("b)")+
theme(legend.margin=margin(0,0,0,0),
   legend.box.margin=margin(-10,-10,-10,-10)) +
  theme(legend.key.size = unit(0.3, 'cm'),
        legend.position = "bottom")

p2_1 = plot_grid(NULL,p2,NULL, ncol = 1, rel_heights  = c(1, 1.5, 0.5),rel_widths  = c(0.1, 2, 0.1))
plot_grid(p1,p2_1, rel_widths = c(16, 7), rel_heights  = c(9, 1), align = "none")



```

